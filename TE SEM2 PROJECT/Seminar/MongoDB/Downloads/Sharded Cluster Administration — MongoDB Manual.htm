<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
    <title>Sharded Cluster Administration — MongoDB Manual</title>

    <link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico">
    <meta name="robots" content="index">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="canonical" href="http://docs.mongodb.org/manual/administration/sharded-clusters">

    
    
    <link rel="stylesheet" href="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/mongodb-docs.css" type="text/css">
    <link rel="stylesheet" href="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/pygments.css" type="text/css">
      
    <script id="undefined" src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/inpage_linkid.js" async="" type="text/javascript"></script><script src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/ga.js" async="" type="text/javascript"></script><script src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/cse.js" async="" type="text/javascript"></script><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/jquery.js"></script>
    <script type="text/javascript" src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/underscore.js"></script>
    <script type="text/javascript" src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/doctools.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help">
<link rel="author" title="About these documents" href="http://docs.mongodb.org/manual/about/">
<link rel="top" title="MongoDB Manual" href="http://docs.mongodb.org/manual/">
<link rel="up" title="Sharding" href="http://docs.mongodb.org/manual/sharding/">
<link rel="next" title="Sharded Cluster Architectures" href="http://docs.mongodb.org/manual/administration/sharded-cluster-architectures/">
<link rel="prev" title="Sharded Cluster Overview" href="http://docs.mongodb.org/manual/core/sharded-clusters/">
<!-- Put the following javascript before the closing </head> tag. -->
<script>
  (function() {
    var cx = '017213726194841070573:WMX6838984';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
  <script type="text/javascript" src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/jsapi"></script><link rel="stylesheet" href="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/defaulten.css" type="text/css"><link rel="stylesheet" href="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/default.css" type="text/css"><script src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/defaulten.js" type="text/javascript"></script><script src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/search.js" type="text/javascript"></script><style type="text/css">
.gsc-control-cse {
font-family: Arial, sans-serif;
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-control-cse .gsc-table-result {
font-family: Arial, sans-serif;
}
input.gsc-input, .gsc-input-box, .gsc-input-box-hover, .gsc-input-box-focus {
border-color: #D9D9D9;
}
input.gsc-search-button, input.gsc-search-button:hover, input.gsc-search-button:focus {
border-color: #5AAC41;
background-color: #5AAC41;
background-image: none;
filter: none;
}
.gsc-tabHeader.gsc-tabhInactive {
border-color: #CCCCCC;
background-color: #FFFFFF;
}
.gsc-tabHeader.gsc-tabhActive {
border-color: #CCCCCC;
border-bottom-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-tabsArea {
border-color: #CCCCCC;
}
.gsc-webResult.gsc-result,
.gsc-results .gsc-imageResult {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-webResult.gsc-result:hover,
.gsc-imageResult:hover {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gs-webResult.gs-result a.gs-title:link,
.gs-webResult.gs-result a.gs-title:link b,
.gs-imageResult a.gs-title:link,
.gs-imageResult a.gs-title:link b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:visited,
.gs-webResult.gs-result a.gs-title:visited b,
.gs-imageResult a.gs-title:visited,
.gs-imageResult a.gs-title:visited b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:hover,
.gs-webResult.gs-result a.gs-title:hover b,
.gs-imageResult a.gs-title:hover,
.gs-imageResult a.gs-title:hover b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:active,
.gs-webResult.gs-result a.gs-title:active b,
.gs-imageResult a.gs-title:active,
.gs-imageResult a.gs-title:active b {
color: #1155CC;
}
.gsc-cursor-page {
color: #1155CC;
}
a.gsc-trailing-more-results:link {
color: #1155CC;
}
.gs-webResult .gs-snippet,
.gs-imageResult .gs-snippet,
.gs-fileFormatType {
color: #333333;
}
.gs-webResult div.gs-visibleUrl,
.gs-imageResult div.gs-visibleUrl {
color: #009933;
}
.gs-webResult div.gs-visibleUrl-short {
color: #009933;
}
.gs-webResult div.gs-visibleUrl-short {
display: none;
}
.gs-webResult div.gs-visibleUrl-long {
display: block;
}
.gs-promotion div.gs-visibleUrl-short {
display: none;
}
.gs-promotion div.gs-visibleUrl-long {
display: block;
}
.gsc-cursor-box {
border-color: #FFFFFF;
}
.gsc-results .gsc-cursor-box .gsc-cursor-page {
border-color: #CCCCCC;
background-color: #FFFFFF;
color: #1155CC;
}
.gsc-results .gsc-cursor-box .gsc-cursor-current-page {
border-color: #CCCCCC;
background-color: #FFFFFF;
color: #1155CC;
}
.gsc-webResult.gsc-result.gsc-promotion {
border-color: #F6F6F6;
background-color: #F6F6F6;
}
.gsc-completion-title {
color: #1155CC;
}
.gsc-completion-snippet {
color: #333333;
}
.gs-promotion a.gs-title:link,
.gs-promotion a.gs-title:link *,
.gs-promotion .gs-snippet a:link {
color: #1155CC;
}
.gs-promotion a.gs-title:visited,
.gs-promotion a.gs-title:visited *,
.gs-promotion .gs-snippet a:visited {
color: #1155CC;
}
.gs-promotion a.gs-title:hover,
.gs-promotion a.gs-title:hover *,
.gs-promotion .gs-snippet a:hover {
color: #1155CC;
}
.gs-promotion a.gs-title:active,
.gs-promotion a.gs-title:active *,
.gs-promotion .gs-snippet a:active {
color: #1155CC;
}
.gs-promotion .gs-snippet,
.gs-promotion .gs-title .gs-promotion-title-right,
.gs-promotion .gs-title .gs-promotion-title-right * {
color: #333333;
}
.gs-promotion .gs-visibleUrl,
.gs-promotion .gs-visibleUrl-short {
color: #009933;
}
.gsc-input input.gsc-input {
background: none repeat scroll 0% 0% white !important;
}
</style><style type="text/css">.gsfe_a{border:1px solid #b9b9b9;border-top-color:#a0a0a0;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);}.gsfe_b{border:1px solid #4d90fe;outline:none;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gscsep_a{display:none}.gsq_a{padding:0}.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;user-select:none;-moz-user-select:none;white-space:nowrap}.gsst_e{opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gssb_a{padding:0 9px}.gsib_a{padding-right:8px;padding-left:8px}.gsst_a{padding-top:3px}.gssb_e{border:0}.gssb_l{margin:5px 0}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style><style type="text/css">.atlwdg-blanket {background:#000;height:100%;left:0;opacity:.5;position:fixed;top:0;width:100%;z-index:1000000;}
.atlwdg-popup {background:#fff;border:1px solid #666;position:fixed;top:50%;left:50%;z-index:10000011;}
.atlwdg-popup.atlwdg-box-shadow {-moz-box-shadow:10px 10px 20px rgba(0,0,0,0.5);-webkit-box-shadow:10px 10px 20px rgba(0,0,0,0.5);box-shadow:10px 10px 20px rgba(0,0,0,0.5);background-color:#fff;}
.atlwdg-hidden {display:none;}
.atlwdg-trigger {position: fixed; background: #013466; padding: 5px;border: 2px solid white;border-top: none; font-weight: bold; color: white; display:block;white-space:nowrap;text-decoration:none; font-family:arial, FreeSans, Helvetica, sans-serif;font-size:12px;box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5);-webkit-box-shadow:5px 5px 10px rgba(0, 0, 0, 0.5); -moz-box-shadow:5px 5px 10px rgba(0, 0, 0, 0.5);border-radius: 0 0 5px 5px; -moz-border-radius: 0 0 5px 5px;}
a.atlwdg-trigger {text-decoration:none;}
.atlwdg-trigger.atlwdg-TOP {left: 45%;top:0; }
.atlwdg-trigger.atlwdg-RIGHT {left:100%; top:40%; -webkit-transform-origin:top left; -webkit-transform: rotate(90deg); -moz-transform: rotate(90deg); -moz-transform-origin:top left;-ms-transform: rotate(90deg); -ms-transform-origin:top left; }
.atlwdg-trigger.atlwdg-SUBTLE { right:0; bottom:0; border: 1px solid #ccc; border-bottom: none; border-right: none; background-color: #f5f5f5; color: #444; font-size: 11px; padding: 6px; box-shadow: -1px -1px 2px rgba(0, 0, 0, 0.5); border-radius: 2px 0 0 0; }
.atlwdg-loading {position:absolute;top:220px;left:295px;}</style></head>
  <body>
<div id="top-right">
        <div class="user-right">
                <ul id="header-menu-bar" class="ajs-menu-bar">
                <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
                <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
                <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
                <li class="normal"><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></li>
                <li class="normal"><a href="http://www.10gen.com/events">Events</a></li>
                <li class="normal last"><a class="last" href="http://docs.mongodb.org/manual/meta/translation">Translations</a></li>
                </ul>
        </div>
</div>
<div id="header-db" class="spread">
        <div class="split">
                <div id="logo">
                        <div><a href="http://docs.mongodb.org/manual/"><img class="logo" src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/logo-mongodb.png" alt="MongoDB Logo"></a></div>
                </div>
        </div>

<div class="search-db"><div dir="ltr" id="___gcse_0"><form accept-charset="utf-8" class="gsc-search-box gsc-search-box-tools"><table class="gsc-search-box" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-input"><div id="gsc-iw-id1" class="gsc-input-box"><table class="gstl_0 " id="gs_id0" style="width: 100%; padding: 0pt;" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsib_a" id="gs_tti0"><input spellcheck="false" dir="ltr" id="gsc-i-id1" style="width: 100%; padding: 0pt; border: medium none; margin: 0pt; height: auto; outline: medium none;" title="search" name="search" class="gsc-input" size="10" autocomplete="off" type="text"></td><td class="gsib_b"><div dir="ltr" id="gs_st0" class="gsst_b"><a style="display: none;" href="javascript:void(0)" class="gsst_a"><span id="gs_cb0" class="gscb_a">×</span></a></div></td></tr></tbody></table></div></td><td class="gsc-search-button"><input title="search" class="gsc-search-button gsc-search-button-v2" src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/search_box_icon.png" type="image"></td><td class="gsc-clear-button"><div title="clear results" class="gsc-clear-button">&nbsp;</div></td></tr></tbody></table><table class="gsc-branding" cellpadding="0" cellspacing="0"><tbody><tr style="display: none;"><td class="gsc-branding-user-defined"></td><td class="gsc-branding-text"><div class="gsc-branding-text">powered by</div></td><td class="gsc-branding-img"><img class="gsc-branding-img" src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/small-logo.png"></td></tr></tbody></table></form></div></div>
<div id="etp">
<ul>
<li><a href="https://github.com/mongodb/docs/blob/master/source/administration/sharded-clusters.txt" target="_blank" title="Edit administration/sharded-clusters.txt on github">Edit this Page</a></li>
<li><a href="http://github.com/mongodb/docs" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
<li><a href="https://jira.mongodb.org/secure/CreateIssueDetails%21init.jspa?pid=10380&amp;issuetype=4&amp;priority=4&amp;summary=Comment+on%3a+%22administration/sharded-clusters%2Etxt%22" target="_blank" title="Report a problem with administration/sharded-clusters.txt on Jira">Report a problem</a></li>
</ul>
</div>
</div>  
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div id="cse-results"><div id="___gcse_1"><div class="gsc-control-cse gsc-control-cse-en"><div dir="ltr" class="gsc-control-wrapper-cse"><div class="gsc-results-wrapper-nooverlay"><div class="gsc-tabsAreaInvisible"><div class="gsc-tabHeader gsc-inline-block gsc-tabhActive">Custom Search</div><span class="gs-spacer"> </span></div><div class="gsc-tabsAreaInvisible"></div><div class="gsc-above-wrapper-area-invisible"><table class="gsc-above-wrapper-area-container" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-result-info-container"><div class="gsc-result-info-invisible"></div></td></tr></tbody></table></div><div class="gsc-adBlockInvisible"></div><div class="gsc-wrapper"><div class="gsc-adBlockInvisible"></div><div class="gsc-resultsbox-invisible"><div class="gsc-resultsRoot gsc-tabData gsc-tabdActive"><table class="gsc-resultsHeader" cellpadding="0" cellspacing="0"><tbody><tr><td class="gsc-twiddleRegionCell"><div class="gsc-twiddle"><div class="gsc-title">Web</div></div><div class="gsc-stats"></div><div class="gsc-results-selector gsc-all-results-active"><div title="show one result" class="gsc-result-selector gsc-one-result">&nbsp;</div><div title="show more results" class="gsc-result-selector gsc-more-results">&nbsp;</div><div title="show all results" class="gsc-result-selector gsc-all-results">&nbsp;</div></div></td><td class="gsc-configLabelCell"></td></tr></tbody></table><div><div class="gsc-expansionArea"></div></div></div></div></div></div></div></div></div></div>
            
  <div class="section" id="sharded-cluster-administration">
<span id="sharding-sharded-cluster"></span><span id="index-0"></span><h1>Sharded Cluster Administration<a class="headerlink" href="#sharded-cluster-administration" title="Permalink to this headline">¶</a></h1>
<p>Sharding occurs within a <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>. A sharded cluster
consists of the following components:</p>
<ul class="simple">
<li><a class="reference internal" href="#sharding-shards"><em>Shards</em></a>. Each shard is a separate
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance or <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a> that holds a portion
of the database collections.</li>
<li><a class="reference internal" href="#sharding-config-server"><em>Config servers</em></a>. Each config server is
a <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance that holds metadata about the cluster.
The metadata maps <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-chunk"><em class="xref std std-term">chunks</em></a> to shards.</li>
<li><a class="reference internal" href="#sharding-mongos"><em>mongos instances</em></a>. The <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>
instances route the reads and writes to the shards.</li>
</ul>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>For specific configurations, see <a class="reference internal" href="http://docs.mongodb.org/manual/administration/sharded-cluster-architectures/#sharding-architecture"><em>Sharded Cluster Architectures</em></a>.</li>
<li>To set up sharded clusters, see <a class="reference internal" href="http://docs.mongodb.org/manual/tutorial/deploy-shard-cluster/#sharding-procedure-setup"><em>Deploy a Sharded Cluster</em></a>.</li>
</ul>
</div>
<span class="target" id="index-1"></span><div class="section" id="shards">
<span id="sharding-shards"></span><span id="index-2"></span><h2>Shards<a class="headerlink" href="#shards" title="Permalink to this headline">¶</a></h2>
<p>A shard is a container that holds a subset of a collection’s data. Each
shard is either a single <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance or a <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-replica-set"><em class="xref std std-term">replica
set</em></a>. In production, all shards should be replica sets.</p>
<p>Applications do not access the shards directly. Instead, the
<a class="reference internal" href="#sharding-mongos"><em>mongos instances</em></a> routes reads and writes from
applications to the shards.</p>
<span class="target" id="index-3"></span></div>
<div class="section" id="config-servers">
<span id="sharding-config-server"></span><span id="index-4"></span><h2>Config Servers<a class="headerlink" href="#config-servers" title="Permalink to this headline">¶</a></h2>
<p>Config servers maintain the shard metadata in a config database. The
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-config-database"><em class="xref std std-term">config database</em></a> stores the relationship between <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-chunk"><em class="xref std std-term">chunks</em></a> and where they reside within a <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>. Without
a config database, the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances would be unable to
route queries or write operations within the cluster.</p>
<p>Config servers <em>do not</em> run as replica sets. Instead, a <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-sharded-cluster"><em class="xref std std-term">cluster</em></a> operates with a group of <em>three</em> config servers that use a
two-phase commit process that ensures immediate consistency and
reliability.</p>
<p>For testing purposes you may deploy a cluster with a single
config server, but this is not recommended for production.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If your cluster has a single config server, this
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> is a single point of failure.  If the instance is
inaccessible the cluster is not accessible. If you cannot recover
the data on a config server, the cluster will be inoperable.</p>
<p class="last"><strong>Always</strong> use three config servers for production deployments.</p>
</div>
<p>The actual load on configuration servers is small because each
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance maintains a cached copy of the configuration
database. MongoDB only writes data to the config server to:</p>
<ul class="simple">
<li>create splits in existing chunks, which happens as data in
existing chunks exceeds the maximum chunk size.</li>
<li>migrate a chunk between shards.</li>
</ul>
<p>Additionally, all config servers must be available on initial setup
of a sharded cluster, each <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance must be able
to write to the <tt class="docutils literal"><span class="pre">config.version</span></tt> collection.</p>
<p>If one or two configuration instances become unavailable, the
cluster’s metadata becomes <em>read only</em>. It is still possible to read
and write data from the shards, but no chunk migrations or splits will
occur until all three servers are accessible. At the same time, config
server data is only read in the following situations:</p>
<ul class="simple">
<li>A new <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> starts for the first time, or an existing
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> restarts.</li>
<li>After a chunk migration, the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances update
themselves with the new cluster metadata.</li>
</ul>
<p>If all three config servers are inaccessible, you can continue to use
the cluster as long as you don’t restart the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>
instances until after config servers are accessible again. If you
restart the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances and there are no accessible
config servers, the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> would be unable to direct
queries or write operations to the cluster.</p>
<p>Because the configuration data is small relative to the amount of data
stored in a cluster, the amount of activity is relatively low, and 100%
up time is not required for a functioning sharded cluster. As a result,
backing up the config servers is not difficult. Backups of config
servers are critical as clusters become totally inoperable when
you lose all configuration instances and data. Precautions to ensure
that the config servers remain available and intact are critical.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Configuration servers store metadata for a single sharded cluster.
You must have a separate configuration server or servers for each
cluster you administer.</p>
</div>
</div>
<div class="section" id="sharded-cluster-operations-and-mongos-instances">
<span id="sharding-read-operations"></span><span id="sharding-mongos"></span><span id="index-5"></span><h2>Sharded Cluster Operations and <tt class="docutils literal"><span class="pre">mongos</span></tt> Instances<a class="headerlink" href="#sharded-cluster-operations-and-mongos-instances" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> program provides a single unified interface to a sharded
cluster for applications using MongoDB. Except for the selection of a
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a>, application developers and administrators need not
consider any of the <a class="reference internal" href="http://docs.mongodb.org/manual/core/sharded-cluster-internals/#sharding-internals"><em>internal details of sharding</em></a>.</p>
<p><a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> caches data from the <a class="reference internal" href="#sharding-config-server"><em>config server</em></a>, and uses this to route operations from
applications and clients to the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances.
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> have no <em>persistent</em> state and consume
minimal system resources.</p>
<p>The most common practice is to run <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances on the
same systems as your application servers, but you can maintain
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances on the shards or on other dedicated
resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.1.</span></p>
<p class="last">Some aggregation operations using the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/command/aggregate/#aggregate" title="aggregate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">aggregate</span></tt></a>
command (i.e. <a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.aggregate/#db.collection.aggregate" title="db.collection.aggregate"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.aggregate()</span></tt></a>,) will cause
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances to require more CPU resources than in
previous versions. This modified performance profile may dictate
alternate architecture decisions if you use the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-aggregation-framework"><em class="xref std std-term">aggregation
framework</em></a> extensively in a sharded environment.</p>
</div>
<div class="section" id="automatic-operation-and-query-routing-with-mongos">
<span id="sharding-query-routing"></span><h3>Automatic Operation and Query Routing with <tt class="docutils literal"><span class="pre">mongos</span></tt><a class="headerlink" href="#automatic-operation-and-query-routing-with-mongos" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> uses information from <a class="reference internal" href="#sharding-config-server"><em>config servers</em></a> to route operations to the cluster as
efficiently as possible. In general, operations in a sharded
environment are either:</p>
<ol class="arabic simple">
<li>Targeted at a single shard or a limited group of shards based on
the shard key.</li>
<li>Broadcast to all shards in the cluster that hold documents in a
collection.</li>
</ol>
<p>When possible you should design your operations to be as targeted as
possible. Operations have the following targeting characteristics:</p>
<ul>
<li><p class="first">Query operations broadcast to all shards <a class="footnote-reference" href="#namespace-exception" id="id1">[1]</a>
<strong>unless</strong> the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> can determine which shard or shard
stores this data.</p>
<p>For queries that include the shard key, <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> can target
the query at a specific shard or set of shards, if the portion
of the shard key included in the query is a <em>prefix</em> of the shard
key. For example, if the shard key is:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> program <em>can</em> route queries that include the full
shard key or either of the following shard key prefixes at a
specific shard or set of shards:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>Depending on the distribution of data in the cluster and the
selectivity of the query, <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> may still have to
contact multiple shards <a class="footnote-reference" href="#possible-all" id="id2">[2]</a> to fulfill these queries.</p>
</li>
<li><p class="first">All <a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a> operations target to
one shard.</p>
</li>
<li><p class="first">All single <a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> operations
target to one shard. This includes <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-upsert"><em class="xref std std-term">upsert</em></a> operations.</p>
</li>
<li><p class="first">The <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> broadcasts multi-update operations to every
shard.</p>
</li>
<li><p class="first">The <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> broadcasts <a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.remove/#db.collection.remove" title="db.collection.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">remove()</span></tt></a> operations to every shard unless the
operation specifies the shard key in full.</p>
</li>
</ul>
<p>While some operations must broadcast to all shards, you can improve
performance by using as many targeted operations as possible by
ensuring that your operations include the shard key.</p>
<table class="docutils footnote" frame="void" id="namespace-exception" rules="none">
<colgroup><col class="label"><col></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>If a shard does not store chunks from a
given collection, queries for documents in that collection are not
broadcast to that shard.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="possible-all" rules="none">
<colgroup><col class="label"><col></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> will route some queries, even
some that include the shard key, to all shards, if needed.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="sharded-query-response-process">
<h3>Sharded Query Response Process<a class="headerlink" href="#sharded-query-response-process" title="Permalink to this headline">¶</a></h3>
<p>To route a query to a <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-sharded-cluster"><em class="xref std std-term">cluster</em></a>,
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> uses the following process:</p>
<ol class="arabic">
<li><p class="first">Determine the list of <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-shard"><em class="xref std std-term">shards</em></a> that must receive the query.</p>
<p>In some cases, when the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a> or a prefix of the shard
key is a part of the query, the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> can route the
query to a subset of the shards. Otherwise, the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>
must direct the query to <em>all</em> shards that hold documents for that
collection.</p>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>Given the following shard key:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">zipcode</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">u_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">c_date</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>Depending on the distribution of chunks in the cluster, the
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> may be able to target the query at a subset of
shards, if the query contains the following fields:</p>
<div class="last highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">zipcode</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">{</span> <span class="nx">zipcode</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">u_id</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">{</span> <span class="nx">zipcode</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">u_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">c_date</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</li>
<li><p class="first">Establish a cursor on all targeted shards.</p>
<p>When the first batch of results returns from the cursors:</p>
<ol class="loweralpha">
<li><p class="first">For query with sorted results (i.e. using
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/cursor.sort/#cursor.sort" title="cursor.sort"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.sort()</span></tt></a>) the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance performs a merge
sort of all queries.</p>
</li>
<li><p class="first">For a query with unsorted results, the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance returns
a result cursor that “round robins” results from all cursors on
the shards.</p>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.0.5: </span>Before 2.0.5, the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> exhausted each cursor,
one by one.</p>
</li>
</ol>
</li>
</ol>
</div>
</div>
<div class="section" id="sharded-cluster-security-considerations">
<span id="sharding-security"></span><h2>Sharded Cluster Security Considerations<a class="headerlink" href="#sharded-cluster-security-considerations" title="Permalink to this headline">¶</a></h2>
<p>MongoDB controls access to <a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-sharded-cluster"><em class="xref std std-term">sharded clusters</em></a>
with key files that store authentication credentials. The components
of sharded clusters use the secret stored in the key files when
authenticating to each other. Create key files and then point your
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> and <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances to the files, as
described later in this section.</p>
<p>Beyond the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/configuration-options/#auth" title="auth"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">auth</span></tt></a> mechanisms described in this section,
always run your sharded clusters in trusted networking environments
that limit access to the cluster with network rules. Your networking
environments should enforce restrictions that ensure only known
traffic reaches your <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> and <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>
instances.</p>
<p>This section describes authentication specific to sharded
clusters. For information on authentication across MongoDB, see
<a class="reference internal" href="http://docs.mongodb.org/manual/administration/security/#security-authentication"><em>Authentication</em></a>.</p>
<div class="section" id="access-control-privileges-in-sharded-clusters">
<h3>Access Control Privileges in Sharded Clusters<a class="headerlink" href="#access-control-privileges-in-sharded-clusters" title="Permalink to this headline">¶</a></h3>
<p>In sharded clusters, MongoDB provides separate administrative
privileges for the sharded cluster and for each shard. Beyond these
administration privileges, privileges for sharded cluster deployments
are functionally the same as any other MongoDB deployment. See,
<a class="reference internal" href="http://docs.mongodb.org/manual/administration/security/#security-authentication"><em>Authentication</em></a> for more information.</p>
<p>For sharded clusters, MongoDB provides these separate administrative
privileges:</p>
<ul>
<li><p class="first">Administrative privileges for the sharded cluster. These privileges
provide read-and-write access to the config servers’ ‘<a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-admin-database"><em class="xref std std-term">admin</em></a>. These users can run all administrative commands.
Administrative privileges also give the user read-and-write access
to all the cluster’s databases.</p>
<p>The credentials for administrative privileges on the cluster reside on
the config servers. To receive admin access to the cluster, you must
authenticate a session while connected to a <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance
using the admin database.</p>
</li>
<li><p class="first">Administrative privileges for the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance, or
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>, that provides each individual shard. Each shard
has its own admin database that stores administrative credentials
and access for that shard only. These credentials are <em>completely</em>
distinct from the cluster-wide administrative credentials.</p>
<p>As with all <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances, MongoDB provides two types
of administrative privileges for a shard:</p>
<ul class="simple">
<li>Normal administrative privileges, which provide read-and-write
access to the admin database and access to all administrative
commands, and which provide read-and-write accees to all other
databases on that shard.</li>
<li>Read-only administrative privileges, which provide read-only access
to the admin database and to all other databases on that shard.</li>
</ul>
</li>
</ul>
<p>Also, as with all <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances, a MongoDB sharded cluster
provides the following non-administrative user privileges:</p>
<ul class="simple">
<li>Normal privileges, which provide read-and-write access to a specific
database. Users with normal privilege can add users to the database.</li>
<li>Read-only privileges, which provide read-only access to a specific
database.</li>
</ul>
<p>For more information on privileges, see <a class="reference internal" href="http://docs.mongodb.org/manual/administration/security/#security-authentication"><em>Authentication</em></a>.</p>
</div>
<div class="section" id="enable-authentication-in-a-sharded-cluster">
<h3>Enable Authentication in a Sharded Cluster<a class="headerlink" href="#enable-authentication-in-a-sharded-cluster" title="Permalink to this headline">¶</a></h3>
<p class="versionadded">
<span class="versionmodified">New in version 2.0: </span>Support for authentication with sharded clusters.</p>
<p>To control access to a sharded cluster, create key files and then set
the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/configuration-options/#keyFile" title="keyFile"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">keyFile</span></tt></a> option on <em>all</em> components of the sharded
cluster, including all <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances, all config server
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances, and all shard <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>
instances. The content of the key file is arbitrary but must be the
same on all cluster members.</p>
<p>To enable authentication, do the following:</p>
<ol class="arabic">
<li><p class="first">Generate a key file to store authentication information, as described
in the <a class="reference internal" href="http://docs.mongodb.org/manual/tutorial/control-access-to-mongodb-with-authentication/#generate-key-file"><em>Generate a Key File</em></a> section.</p>
</li>
<li><p class="first">On each component in the sharded cluster, enable authentication by
doing one of the following:</p>
<ul>
<li><p class="first">In the configuration file, set the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/configuration-options/#keyFile" title="keyFile"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">keyFile</span></tt></a> option to the
key file’s path and then start the component, as in the following
example:</p>
<div class="highlight-cfg"><div class="highlight"><pre><span class="na">keyFile</span> <span class="o">=</span> <span class="s">/srv/mongodb/keyfile</span>
</pre></div>
</div>
</li>
<li><p class="first">When starting the component, set <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#cmdoption-mongos--keyFile"><em class="xref std std-option">--keyFile</em></a> option,
which is an option for both <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances and
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongod/#mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances. Set the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/mongos/#cmdoption-mongos--keyFile"><em class="xref std std-option">--keyFile</em></a>
to the key file’s path.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="http://docs.mongodb.org/manual/reference/configuration-options/#keyFile" title="keyFile"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">keyFile</span></tt></a> setting implies <a class="reference internal" href="http://docs.mongodb.org/manual/reference/configuration-options/#auth" title="auth"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">auth</span></tt></a>, which
means in most cases you do not need to set <a class="reference internal" href="http://docs.mongodb.org/manual/reference/configuration-options/#auth" title="auth"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">auth</span></tt></a>
explicitly.</p>
</div>
</li>
<li><p class="first">Add the first administrative user and then add subsequent users. See
<a class="reference internal" href="http://docs.mongodb.org/manual/tutorial/control-access-to-mongodb-with-authentication/#control-access-add-users"><em>Add Users</em></a>.</p>
</li>
</ol>
</div>
<div class="section" id="access-a-sharded-cluster-with-authentication">
<h3>Access a Sharded Cluster with Authentication<a class="headerlink" href="#access-a-sharded-cluster-with-authentication" title="Permalink to this headline">¶</a></h3>
<p>To access a sharded cluster as an authenticated admin user, see
<a class="reference internal" href="http://docs.mongodb.org/manual/tutorial/control-access-to-mongodb-with-authentication/#control-access-admin-access"><em>Administrative Access in MongoDB</em></a>.</p>
<p>To access a sharded cluster as an authenticated, non-admin user, see
either of the following:</p>
<ul class="simple">
<li><a class="reference internal" href="http://docs.mongodb.org/manual/reference/command/authenticate/#authenticate" title="authenticate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">authenticate</span></tt></a></li>
<li><a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.auth/#db.auth" title="db.auth"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.auth()</span></tt></a></li>
</ul>
<p>To terminate an authenticated session, see the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/command/logout/#logout" title="logout"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">logout</span></tt></a>
command.</p>
</div>
</div>
</div>


<div id="btnv">
<ul id="btnvl">
<li id="btnvpr"><a href="http://docs.mongodb.org/manual/core/sharded-clusters/" title="Previous Section: Sharded Cluster Overview">&lt; &nbsp; Sharded Cluster Overview</a></li>
<li id="btnvup"><a href="http://docs.mongodb.org/manual/sharding/" title="Parent Section: Sharding">/\&nbsp; Sharding</a></li>
<li id="btnvnx"><a href="http://docs.mongodb.org/manual/administration/sharded-cluster-architectures/" title="Next Section: Sharded Cluster Architectures">Sharded Cluster Architectures &nbsp;&gt;</a></li>
</ul>
</div>
</div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><h3><a href="http://docs.mongodb.org/manual/contents/">MongoDB Manual</a>

<small><a href="http://docs.mongodb.org/manual/genindex/">(Index)</a></small>

</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/installation/">Installing MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/administration/">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/crud/">Core MongoDB Operations (CRUD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/aggregation/">Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/indexes/">Indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/replication/">Replication</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="http://docs.mongodb.org/manual/sharding/">Sharding</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="http://docs.mongodb.org/manual/sharding/#sharded-cluster-use-and-operation">Sharded Cluster Use and Operation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="http://docs.mongodb.org/manual/core/sharded-clusters/">Sharded Cluster Overview</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Sharded Cluster Administration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#shards">Shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="#config-servers">Config Servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sharded-cluster-operations-and-mongos-instances">Sharded Cluster Operations and <tt class="docutils literal"><span class="pre">mongos</span></tt> Instances</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#automatic-operation-and-query-routing-with-mongos">Automatic Operation and Query Routing with <tt class="docutils literal"><span class="pre">mongos</span></tt></a></li>
<li class="toctree-l5"><a class="reference internal" href="#sharded-query-response-process">Sharded Query Response Process</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#sharded-cluster-security-considerations">Sharded Cluster Security Considerations</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#access-control-privileges-in-sharded-clusters">Access Control Privileges in Sharded Clusters</a></li>
<li class="toctree-l5"><a class="reference internal" href="#enable-authentication-in-a-sharded-cluster">Enable Authentication in a Sharded Cluster</a></li>
<li class="toctree-l5"><a class="reference internal" href="#access-a-sharded-cluster-with-authentication">Access a Sharded Cluster with Authentication</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="http://docs.mongodb.org/manual/administration/sharded-cluster-architectures/">Sharded Cluster Architectures</a></li>
<li class="toctree-l3"><a class="reference internal" href="http://docs.mongodb.org/manual/core/sharded-cluster-internals/">Sharded Cluster Internals and Behaviors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.mongodb.org/manual/sharding/#sharded-cluster-tutorials-and-procedures">Sharded Cluster Tutorials and Procedures</a></li>
<li class="toctree-l2"><a class="reference internal" href="http://docs.mongodb.org/manual/sharding/#sharded-cluster-reference">Sharded Cluster Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/applications/">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/mongo/">Using the <tt class="docutils literal"><span class="pre">mongo</span></tt> Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/use-cases/">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/tutorial/">MongoDB Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/faq/">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/reference/">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="http://docs.mongodb.org/manual/about/">About MongoDB Documentation</a></li>
</ul>

<h3 style="padding-bottom: 1em;"><a href="http://www.mongodb.org/about/">MongoDB.org</a></h3>
<h3 style="padding-bottom: 1em;"><a href="http://docs.mongodb.org/ecosystem/">MongoDB Ecosystem</a></h3><h3>Formats</h3>
<ul class="this-page-menu">
  <li><a href="http://docs.mongodb.org/master/single/">MongoDB Manual, Single HTML Page</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.pdf" rel="nofollow">MongoDB Manual, PDF Format</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.epub" rel="nofollow">MongoDB Manual, ePub Format</a></li>
</ul><h3>MongoDB Resources</h3>

<ul>
 <li><strong>Getting Started</strong>
   <ul>
     <li><a href="http://www.mongodb.org/about/introduction">Introduction</a></li>
     <li><a href="http://www.mongodb.org/downloads">Downloads</a></li>
   </ul>
 </li>
 <li><strong><a href="http://www.mongodb.org/about/community">Community</a> and <a href="http://docs.mongodb.org/ecosystem/">Ecosystem</a></strong>
   <ul>
     <li><a href="http://www.10gen.com/">10gen</a></li>
     <li><a href="http://www.10gen.com/events">MongoDB Events</a></li>
     <li><a href="http://planet.mongodb.org/">Planet MongoDB</a></li>
     <li><a href="http://mongodb.org/about/community/masters">MongoDB Masters</a></li>
     <li><a href="http://www.10gen.com/presentations">Slides and Video</a></li>
     <li><a href="http://docs.mongodb.org/ecosystem/platforms/">Hosting Center</a></li>
     <li><a href="http://docs.mongodb.org/ecosystem/platforms/windows">Windows</a></li>
     <li><a href="http://www.10gen.com/products/mms/">MongoDB Monitoring Service</a> (<a href="http://mms.10gen.com/help/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/tools/administration-interfaces/">Administrative Interfaces</a></li>
     <li><a href="http://www.10gen.com/books/">MongoDB Books</a></li>
   </ul>
 </li>
 <li><strong><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></strong>
   <ul>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/javascript">JavaScript</a> (<a href="http://api.mongodb.org/js/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/python">Python</a> (<a href="http://api.mongodb.org/python/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/ruby">Ruby</a> (<a href="http://api.mongodb.org/ruby/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/php">PHP</a> (<a href="http://php.net/mongo/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/perl">Perl</a> (<a href="http://api.mongodb.org/perl/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/java">Java</a> (<a href="http://api.mongodb.org/java/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/scala">Scala</a> (<a href="http://api.mongodb.org/scala/casbah/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/csharp">C#</a> (<a href="http://api.mongodb.org/csharp/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/c">C</a> (<a href="http://api.mongodb.org/c/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/cpp">C++</a> (<a href="http://api.mongodb.org/cplusplus/current/">docs</a>)</li>
     <li><a href="http://hackage.haskell.org/package/mongoDB">Haskell</a> (<a href="http://api.mongodb.org/haskell">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/erlang">Erlang</a> (<a href="http://api.mongodb.org/erlang">docs</a>)</li>
   </ul>
 </li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    <p>
       © <a href="">Copyright</a> 2011-2013, 10gen, Inc. 
       MongoDB®, Mongo®, and the leaf logo are registered trademarks of 10gen, Inc.
    </p>
  </div><script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
_gaq.push(['_setAccount', 'UA-7301842-8']);
_gaq.push(['_setDomainName', 'docs.mongodb.org']);
_gaq.push(['_trackPageview']);
(function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
        })();
</script>

<script type="text/javascript">
document.write(unescape("%3Cscript src='" + document.location.protocol + "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="Sharded%20Cluster%20Administration%20%E2%80%94%20MongoDB%20Manual_files/munchkin.htm" type="text/javascript"></script>
<script>try { mktoMunchkin("017-HGS-593"); } catch(e) {}</script><script type="text/javascript">
jQuery.ajax({
    url: "https://jira.mongodb.org/s/en_US-bxctp1/782/6/1.2.4/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId=298ba4e7",
    type: "get",
    cache: true,
    dataType: "script"
});
window.ATL_JQ_PAGE_PROPS =  {
"triggerFunction": function(showCollectorDialog) {
jQuery("#jirafeedback").click(function(e) {e.preventDefault();showCollectorDialog();});
jQuery("#jirafooter").click(function(e) {e.preventDefault();showCollectorDialog();});
}};
</script>

<table class="gstl_0 gssb_c" style="width: 129px; display: none; top: 70px; left: 751px; position: absolute;" cellpadding="0" cellspacing="0"><tbody><tr><td class="gssb_f"></td><td style="width: 100%;" class="gssb_e"></td></tr></tbody></table><div style="display: none;" id="atlwdg-blanket" class="atlwdg-blanket"></div><div class="atlwdg-popup atlwdg-box-shadow atlwdg-hidden" id="atlwdg-container"></div></body></html>