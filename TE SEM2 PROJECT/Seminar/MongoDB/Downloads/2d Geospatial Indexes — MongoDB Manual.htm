<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
    <title>2d Geospatial Indexes — MongoDB Manual</title>

    <link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico">
    <meta name="robots" content="index">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="canonical" href="http://docs.mongodb.org/manual/core/geospatial-indexes">

    
    
    <link rel="stylesheet" href="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/mongodb-docs.css" type="text/css">
    <link rel="stylesheet" href="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/pygments.css" type="text/css">
      
    <script src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/cse.js" async="" type="text/javascript"></script><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/jquery.js"></script>
    <script type="text/javascript" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/underscore.js"></script>
    <script type="text/javascript" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/doctools.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help">
<link rel="author" title="About these documents" href="http://docs.mongodb.org/manual/about/">
<link rel="top" title="MongoDB Manual" href="http://docs.mongodb.org/manual/">
<link rel="up" title="Indexes" href="http://docs.mongodb.org/manual/indexes/">
<link rel="next" title="Replication" href="http://docs.mongodb.org/manual/replication/">
<link rel="prev" title="Geospatial Queries with 2d Indexes" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/">
<!-- Put the following javascript before the closing </head> tag. -->
<script>
  (function() {
    var cx = '017213726194841070573:WMX6838984';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
  <script type="text/javascript" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/jsapi"></script><link rel="stylesheet" href="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/defaulten.css" type="text/css"><link rel="stylesheet" href="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/default.css" type="text/css"><script src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/defaulten.js" type="text/javascript"></script><script src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/search.js" type="text/javascript"></script><style type="text/css">
.gsc-control-cse {
font-family: Arial, sans-serif;
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-control-cse .gsc-table-result {
font-family: Arial, sans-serif;
}
input.gsc-input, .gsc-input-box, .gsc-input-box-hover, .gsc-input-box-focus {
border-color: #D9D9D9;
}
input.gsc-search-button, input.gsc-search-button:hover, input.gsc-search-button:focus {
border-color: #5AAC41;
background-color: #5AAC41;
background-image: none;
filter: none;
}
.gsc-tabHeader.gsc-tabhInactive {
border-color: #CCCCCC;
background-color: #FFFFFF;
}
.gsc-tabHeader.gsc-tabhActive {
border-color: #CCCCCC;
border-bottom-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-tabsArea {
border-color: #CCCCCC;
}
.gsc-webResult.gsc-result,
.gsc-results .gsc-imageResult {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-webResult.gsc-result:hover,
.gsc-imageResult:hover {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gs-webResult.gs-result a.gs-title:link,
.gs-webResult.gs-result a.gs-title:link b,
.gs-imageResult a.gs-title:link,
.gs-imageResult a.gs-title:link b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:visited,
.gs-webResult.gs-result a.gs-title:visited b,
.gs-imageResult a.gs-title:visited,
.gs-imageResult a.gs-title:visited b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:hover,
.gs-webResult.gs-result a.gs-title:hover b,
.gs-imageResult a.gs-title:hover,
.gs-imageResult a.gs-title:hover b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:active,
.gs-webResult.gs-result a.gs-title:active b,
.gs-imageResult a.gs-title:active,
.gs-imageResult a.gs-title:active b {
color: #1155CC;
}
.gsc-cursor-page {
color: #1155CC;
}
a.gsc-trailing-more-results:link {
color: #1155CC;
}
.gs-webResult .gs-snippet,
.gs-imageResult .gs-snippet,
.gs-fileFormatType {
color: #333333;
}
.gs-webResult div.gs-visibleUrl,
.gs-imageResult div.gs-visibleUrl {
color: #009933;
}
.gs-webResult div.gs-visibleUrl-short {
color: #009933;
}
.gs-webResult div.gs-visibleUrl-short {
display: none;
}
.gs-webResult div.gs-visibleUrl-long {
display: block;
}
.gs-promotion div.gs-visibleUrl-short {
display: none;
}
.gs-promotion div.gs-visibleUrl-long {
display: block;
}
.gsc-cursor-box {
border-color: #FFFFFF;
}
.gsc-results .gsc-cursor-box .gsc-cursor-page {
border-color: #CCCCCC;
background-color: #FFFFFF;
color: #1155CC;
}
.gsc-results .gsc-cursor-box .gsc-cursor-current-page {
border-color: #CCCCCC;
background-color: #FFFFFF;
color: #1155CC;
}
.gsc-webResult.gsc-result.gsc-promotion {
border-color: #F6F6F6;
background-color: #F6F6F6;
}
.gsc-completion-title {
color: #1155CC;
}
.gsc-completion-snippet {
color: #333333;
}
.gs-promotion a.gs-title:link,
.gs-promotion a.gs-title:link *,
.gs-promotion .gs-snippet a:link {
color: #1155CC;
}
.gs-promotion a.gs-title:visited,
.gs-promotion a.gs-title:visited *,
.gs-promotion .gs-snippet a:visited {
color: #1155CC;
}
.gs-promotion a.gs-title:hover,
.gs-promotion a.gs-title:hover *,
.gs-promotion .gs-snippet a:hover {
color: #1155CC;
}
.gs-promotion a.gs-title:active,
.gs-promotion a.gs-title:active *,
.gs-promotion .gs-snippet a:active {
color: #1155CC;
}
.gs-promotion .gs-snippet,
.gs-promotion .gs-title .gs-promotion-title-right,
.gs-promotion .gs-title .gs-promotion-title-right * {
color: #333333;
}
.gs-promotion .gs-visibleUrl,
.gs-promotion .gs-visibleUrl-short {
color: #009933;
}
.gsc-input input.gsc-input {
background: none repeat scroll 0% 0% white !important;
}
</style></head>
  <body>
<div id="top-right">
        <div class="user-right">
                <ul id="header-menu-bar" class="ajs-menu-bar">
                <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
                <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
                <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
                <li class="normal"><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></li>
                <li class="normal"><a href="http://www.10gen.com/events">Events</a></li>
                <li class="normal last"><a class="last" href="http://docs.mongodb.org/manual/meta/translation">Translations</a></li>
                </ul>
        </div>
</div>
<div id="header-db" class="spread">
        <div class="split">
                <div id="logo">
                        <div><a href="http://docs.mongodb.org/manual/"><img class="logo" src="2d%20Geospatial%20Indexes%20%E2%80%94%20MongoDB%20Manual_files/logo-mongodb.png" alt="MongoDB Logo"></a></div>
                </div>
        </div>

<div class="search-db"><gcse:searchbox></gcse:searchbox></div>
<div id="etp">
<ul>
<li><a href="https://github.com/mongodb/docs/blob/master/source/core/geospatial-indexes.txt" target="_blank" title="Edit core/geospatial-indexes.txt on github">Edit this Page</a></li>
<li><a href="http://github.com/mongodb/docs" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
<li><a href="https://jira.mongodb.org/secure/CreateIssueDetails%21init.jspa?pid=10380&amp;issuetype=4&amp;priority=4&amp;summary=Comment+on%3a+%22core/geospatial-indexes%2Etxt%22" target="_blank" title="Report a problem with core/geospatial-indexes.txt on Jira">Report a problem</a></li>
</ul>
</div>
</div>  
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div id="cse-results"><gcse:searchresults></gcse:searchresults></div>
            
  <div class="section" id="d-geospatial-indexes">
<h1><tt class="docutils literal"><span class="pre">2d</span></tt> Geospatial Indexes<a class="headerlink" href="#d-geospatial-indexes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">2d</span></tt> geospatial indexes make it possible to associate documents with
locations in two-dimensional space, such as a point on a map. MongoDB
interprets two-dimensional coordinates in a location field as points
and can index these points in a special index type to support
location-based queries. Geospatial indexes provide special geospatial
query operators. For example, you can query for documents based on
proximity to another location or based on inclusion in a specified
region.</p>
<p>Geospatial indexes support queries on both the coordinate field <em>and</em>
another field, such as a type of business or attraction. For example,
you might write a query to find restaurants a specific distance from a
hotel or to find museums within a certain defined neighborhood.</p>
<p>This document describes how to store location data in your documents
and how to create geospatial indexes. For information on querying data
stored in geospatial indexes, see <a class="reference internal" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/"><em>Geospatial Queries with 2d Indexes</em></a>.</p>
</div>
<div class="section" id="store-location-data">
<span id="geospatial-indexes-coordinates"></span><h2>Store Location Data<a class="headerlink" href="#store-location-data" title="Permalink to this headline">¶</a></h2>
<p>To use <tt class="docutils literal"><span class="pre">2d</span></tt> geospatial indexes, you must model location data on a
predetermined two-dimensional coordinate system, such as longitude
and latitude. You store a document’s location data as two coordinates
in a field that holds either a two-dimensional array or an embedded
document with two fields. Consider the following two examples:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">loc</span> <span class="o">:</span> <span class="p">[</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="p">]</span>

<span class="nx">loc</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span> <span class="p">}</span>
</pre></div>
</div>
<p>All documents must store location data in the same order. If
you use latitude and longitude as your coordinate system, always store
longitude first. MongoDB’s <a class="reference internal" href="http://docs.mongodb.org/manual/applications/geospatial-indexes/#geospatial-indexes-spherical"><em>2d spherical index operators</em></a> only recognize <tt class="docutils literal"><span class="pre">[</span> <span class="pre">longitude,</span> <span class="pre">latitude]</span></tt>
ordering.</p>
</div>
<div class="section" id="create-a-geospatial-index">
<span id="geospatial-indexes-create"></span><h2>Create a Geospatial Index<a class="headerlink" href="#create-a-geospatial-index" title="Permalink to this headline">¶</a></h2>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">MongoDB only supports <em>one</em> geospatial index per
collection.</p>
</div>
<p>To create a geospatial index, use the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex</span></tt></a> method with the value <tt class="docutils literal"><span class="pre">2d</span></tt> for the
location field of your collection. Consider the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">location</span> <span class="nx">field</span><span class="o">&gt;</span> <span class="o">:</span> <span class="s2">"2d"</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>MongoDB’s <a class="reference internal" href="http://docs.mongodb.org/manual/reference/operators/#geospatial-query-operators"><em>geospatial operations</em></a> use this index when querying for location
data.</p>
<p>When you create the index, MongoDB converts location data to binary
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/glossary/#term-geohash"><em class="xref std std-term">geohash</em></a> values and calculates these values using the location
data and the index’s location range, as described in
<a class="reference internal" href="#geospatial-indexes-range"><em>Location Range</em></a>. The default range for <tt class="docutils literal"><span class="pre">2d</span></tt> indexes
assumes longitude and latitude and uses the bounds -180 inclusive and
180 non-inclusive.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The default boundaries of <tt class="docutils literal"><span class="pre">2d</span></tt> indexes allow
applications to insert documents with invalid latitudes greater
than 90 or less than -90. The behavior of geospatial queries with
such invalid points is not defined.</p>
</div>
<p>When creating a <tt class="docutils literal"><span class="pre">2d</span></tt> index, MongoDB provides the following options:</p>
<div class="section" id="location-range">
<span id="geospatial-indexes-range"></span><h3>Location Range<a class="headerlink" href="#location-range" title="Permalink to this headline">¶</a></h3>
<p>All <tt class="docutils literal"><span class="pre">2d</span></tt> geospatial indexes have boundaries defined by a coordinate
range. By default, <tt class="docutils literal"><span class="pre">2d</span></tt> geospatial indexes assume longitude and
latitude have boundaries of -180 inclusive and 180 non-inclusive
(i.e. <tt class="docutils literal"><span class="pre">[-180,</span> <span class="pre">180)</span></tt>). MongoDB returns an error and rejects documents
with coordinate data outside of the specified range.</p>
<p>To build an index with a location range other than the
default, use the <tt class="docutils literal"><span class="pre">min</span></tt> and <tt class="docutils literal"><span class="pre">max</span></tt> options with the
<a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a> operation when
creating a <tt class="docutils literal"><span class="pre">2d</span></tt> index, as in the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">location</span> <span class="nx">field</span><span class="o">&gt;:</span> <span class="s2">"2d"</span> <span class="p">}</span> <span class="p">,</span>
                           <span class="p">{</span> <span class="nx">min</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">lower</span> <span class="nx">bound</span><span class="o">&gt;</span> <span class="p">,</span> <span class="nx">max</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">upper</span> <span class="nx">bound</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="location-precision">
<span id="geospatial-indexes-precision"></span><h3>Location Precision<a class="headerlink" href="#location-precision" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">2d</span></tt> indexes use a <a class="reference internal" href="#geospatial-indexes-geohash"><em>geohash</em></a>
representation of all coordinate data internally. Geohashes have a
precision that is determined by the number of bits in the hash. More bits
allow the index to provide results with greater precision, while fewer
bits mean the index provides results with more limited
precision.</p>
<p>Indexes with lower precision have a lower processing overhead for
insert operations and will consume less space. However, higher
precision indexes means that queries will need to scan smaller
portions of the index to return results. The actual stored values are
always used in the final query processing, and index precision does
not affect query accuracy.</p>
<p>By default, geospatial indexes use 26 bits of precision, which is
roughly equivalent to 2 feet or about 60 centimeters of precision
using the default range of -180 to 180. You can configure <tt class="docutils literal"><span class="pre">2d</span></tt>
geospatial indexes with up to 32 bits of precision.</p>
<p>To configure a location precision other than the default, use the
<tt class="docutils literal"><span class="pre">bits</span></tt> option in the <a class="reference internal" href="http://docs.mongodb.org/manual/reference/method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a> method,
as in the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span><span class="o">&lt;</span><span class="nx">location</span> <span class="nx">field</span><span class="o">&gt;:</span> <span class="s2">"2d"</span><span class="p">}</span> <span class="p">,</span>
                           <span class="p">{</span> <span class="nx">bits</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">bit</span> <span class="nx">precision</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>For more information on the relationship between bits and precision,
see <a class="reference internal" href="#geospatial-indexes-geohash"><em>Geohash Values</em></a>.</p>
</div>
<div class="section" id="compound-geospatial-indexes">
<h3>Compound Geospatial Indexes<a class="headerlink" href="#compound-geospatial-indexes" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">2d</span></tt> geospatial indexes may be <a class="reference internal" href="http://docs.mongodb.org/manual/core/indexes/#index-type-compound"><em>compound</em></a>, if and only if the field with location data is
the first field. A compound geospatial index makes it possible to
construct queries that primarily select on a location-based field but
also select on a second criteria. For example, you could use such
an index to support queries for carpet wholesalers within a specific
region.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Geospatial queries will <em>only</em> use additional query
parameters after applying the geospatial criteria. If your
geospatial query criteria selects a large number of
documents, the additional query will only filter the result set
and <em>not</em> result in a more targeted query.</p>
</div>
<p>To create a geospatial index with two fields, specify the location field
first, then the second field. For example, to create a compound index on
the <tt class="docutils literal"><span class="pre">loc</span></tt> location field and on the <tt class="docutils literal"><span class="pre">product</span></tt> field (sorted in
ascending order), you would issue the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">storeInfo</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="nx">loc</span><span class="o">:</span> <span class="s2">"2d"</span><span class="p">,</span> <span class="nx">product</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
<p>This creates an index that supports queries on just the location field
(i.e. <tt class="docutils literal"><span class="pre">loc</span></tt>), as well as queries on both the <tt class="docutils literal"><span class="pre">loc</span></tt> and
<tt class="docutils literal"><span class="pre">product</span></tt>.</p>
</div>
<div class="section" id="haystack-indexes">
<span id="geospatial-indexes-haystack-index"></span><h3>Haystack Indexes<a class="headerlink" href="#haystack-indexes" title="Permalink to this headline">¶</a></h3>
<p>Haystack indexes create “buckets” of documents from the same geographic
area in order to improve performance for queries limited to that area.</p>
<p>Each bucket in a haystack index contains all the documents within a
specified proximity to a given longitude and latitude. Use the
<tt class="docutils literal"><span class="pre">bucketSize</span></tt> parameter of </p></div></div></div></div></div></div></div></body></html>